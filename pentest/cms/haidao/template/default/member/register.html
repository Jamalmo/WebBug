{template toper common}
<!-- 头部 -->
<div class="header container">
	<div class="logo fl">
		<span><a href="/"><img src="{SKIN_PATH}statics/images/logo.png" /></a></span>
	</div>
	<div class="fr">
		<span class="text-default login-tips">已注册的会员请 <a class="text-sub" href="<?php echo url('login',array('url_forward'=>$_GET['url_forward']));?>">登录</a></span>
	</div>
</div>
<?php
	$setting = cache('setting');
?>
	<!-- 登录 -->
	<div class="layout border-top">
		<div class="container">
			<div class="padding-left border-left border-middle border-sub cart-address">注册新会员</div>
		</div>
		<div class="container padding-big border border-gray-white clearfix">
			<div class="double-line reg-list text-default clearfix">
				<form action="{url('register')}" name="register" method="post">
					<div class="list margin-big-top">
						<input type="hidden" name="url_forward" value="{$_GET[url_forward]}">
						<span class="label">用户名：</span>
						<div class="content">
							<input class="input radius" type="text" name="username" placeholder="请输入您的用户名！" datatype="s2-15" nullmsg="请填写用户名，由3-15个字符组成" errormsg="请填写用户名，由3-15个字符组成" ajaxurl="{url('ajax_register_check')}" />
						</div>
					</div>
					<div class="list margin-big-top">
						<span class="label">登录密码：</span>
						<div class="content">
							<input class="input radius" type="password" name="password" placeholder="请输入登陆密码" datatype="*" ajaxurl="{url('ajax_register_check')}" nullmsg="请输入登陆密码" />
						</div>
					</div>
					<div class="list margin-big-top">
						<span class="label">确认密码：</span>
						<div class="content">
							<input class="input radius" type="password" name="pwdconfirm" placeholder="请输入确认密码" datatype="*" nullmsg="请输入确认密码" recheck="password" />
						</div>
					</div>
					<?php if(in_array('email',$setting['reg_user_fields'])){?>
						<div class="list margin-big-top">
							<span class="label">邮箱：</span>
							<div class="content">
								<input class="input radius" type="text" name="email" placeholder="请输入您的邮箱地址！" datatype="email" nullmsg="请输入您的电子邮箱" ajaxurl="{url('ajax_register_check')}" />
							</div>
						</div>
						<?php } ?>
							<?php if(in_array('phone',$setting['reg_user_fields'])){?>
								<div class="list margin-big-top">
									<span class="label">手机：</span>
									<div class="content">
										<input class="input radius" type="text" name="mobile" placeholder="请输入您的手机号码！" datatype="mobile" ajaxurl="{url('ajax_register_check')}" nullmsg="请输入手机号码" />
									</div>
								</div>
								<?php } ?>
									{hook member_register_input}
									<div class="list">
										<span class="label"></span>
										<div class="content text-small">
												<input class="va-m" type="checkbox" checked/> 同意 <a class="text-main reg-xy" href="javascript:;">《网站服务协议》</a>
										</div>
									</div>
									<div class="list">
										<span class="label"></span>
										<div class="content reg-btn">
											<input class="button bg-sub text-default" type="submit" name="dosubmit" value="注册" />
										</div>
									</div>
				</form>
			</div>
		</div>
	</div>
	<div id="xy" class="popup-item">
		<textarea class="fl layout textarea padding text-gray border-none" readonly="readonly" style="height:300px;">
			<?php echo $setting['reg_agreement']?>
		</textarea>
	</div>
	<!--底部-->
	{template footer common}
	<script type="text/javascript">
		var register = $("form[name=register]").Validform({
			showAllError:true,
			ajaxPost:true,
			callback:function(ret) {
				if(ret.status == 0) {
					$.tips({
						icon:'error',
						content:ret.message,
						callback:function() {
							return false;
						}
					});
				}else{
					$.tips({
						icon:'success',
						content:ret.message,
						callback:function() {
							window.location.href=ret.referer;
						}
					});
				}
			}
		})
		
		$(function(){
			$(".reg-xy").click(function(){
				top.dialog({
					title: '用户协议',
					content: $("#xy"),
					width: 600,
					cancelValue: '关闭',
					cancel: function(){
					}
				}).showModal();
			})
		});
		$(".va-m").click(function(){
			if($(".va-m").prop("checked")){
				$(".content .button").val("注册").css("background","#1380cb");
				$(".content .button").attr("disabled",false);
			}else{
				$(".content .button").val("请同意网站服务协议").css("background","rgb(152, 152, 152)");
				$(".content .button").attr("disabled",true);
			}
		});
	</script>