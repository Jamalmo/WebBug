/* 支付订单 */
var hd_pay = (function() {

	var real_amount = 0;
	var member_money = 0;

	/* 点击余额付款框 */
	$(".balance").live("click",function() {
		hd_pay.balance();
	});

	/* 点击提交 */
	$("#subbtn").live("click",function() {
		hd_pay.dosubmit();
	})
	
	return{

		init : function() {
			if (typeof(order) != 'object') {
				$.dialogTip({content: '无法读取此订单信息！'});
				location.href = '/';
				return;
			}
			$(document).ready(function($) {
				$("div .pay-way .item:first-child").addClass('selected');	// 默认选中支付方式第一个
				real_amount = parseFloat(order.real_amount);	// 应付金额
				member_money = parseFloat(member.money);		// 会员余额
				if (member_money >= real_amount) {
					// 选中余额支付
					$(".balance").addClass('border-main').find('input').prop("checked",true);
					// 隐藏在线支付
					// $(".pays").addClass('hidden');
				}
			});
		},

		balance : function() {
			if (member_money == 0) {
				$.dialogTip({content: '余额不足，请先充值'});
				return false;
			}
			if ($(".balance input").prop("checked") == true) {
				$(".balance").removeClass('border-main').find('input').prop("checked",false);
				$(".pays").removeClass('hidden');
				$("input[name=balance_checked]").val(0);
			} else {
				$(".balance").addClass('border-main').find('input').prop("checked",true);
				$("input[name=balance_checked]").val(1);
				if (member_money >= real_amount) {
					$(".pays").addClass('hidden');
				}
			}
		},

		dosubmit : function() {
			// 是否勾选余额支付
			var balance_checked = $(".balance input[type=checkbox]").prop("checked");
			// 支付方式
			var pay_code = $("div .pay-way .selected").attr("data-code");
			// 网银bank
			var pay_bank = $("div .pay-way .selected").attr("data-defaultbank");
			if (balance_checked == false && pay_code == undefined) {
				$.dialogTip({content: '请选择支付方式'});
				return false;
			}
			if ((real_amount > member_money) && pay_code == undefined) {
				$.dialogTip({content: '请选择支付方式'});
				return false;
			}
			if (balance_checked == true && (member_money >= real_amount)) {
				$("form[name=dopay]").attr("target",'_self');
			} else {
				$("form[name=dopay]").attr("target",'_blank');
			}
			// 赋值参数
			$("input[name=pay_code]").val(pay_code);
			$("input[name=pay_bank]").val(pay_bank);
			$("form[name=dopay]").submit();
		}
	};

})();