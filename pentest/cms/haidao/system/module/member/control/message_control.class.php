<?php
/**
 *      [Haidao] (C)2013-2099 Dmibox Science and technology co., LTD.
 *      This is NOT a freeware, use is subject to license terms
 *
 *      http://www.haidao.la
 *      tel:400-600-2042
 */
class message_control extends cp_control {
	public function _initialize() {
		parent::_initialize();
		$this->service = model('member/member_message', 'service');
	}
	/* 系统消息 */
	public function index() {
		$sqlmap = array();
		$sqlmap['mid'] = $this->member['id'];
		if(isset($_GET['status'])){
			$sqlmap['status'] = (int)$_GET['status'];
		}
		$result = model('member_message')->where($sqlmap)->page($_GET['page'])->limit($_GET['limit'])->select();
		$count = model('member_message')->where($sqlmap)->count();
		$pages = pages($count,$_GET['limit']);
		$SEO = seo('我的消息 - 会员中心');
		include template('message');
	}
	/* 已读 */
	public function ajax_update(){
		if(!$this->member['id']){
			showmessage('参数错误');
			return FALSE;
		}
		$result = $this->service->ajax_update($_GET['id']);
		showmessage(lang('_OPERATION_SUCCESS_'),'',1);
	}
	/* 删除 */
	public function delete(){
		if(!$this->member['id']){
			showmessage('参数错误');
			return FALSE;
		}
		$result = $this->service->delete($_GET['id']);
		showmessage(lang('_OPERATION_SUCCESS_'),'',1,'json');
	}
}